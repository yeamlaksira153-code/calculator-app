<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator App</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Custom styles for calculator */
        .calculator {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border-radius: 20px;
            overflow: hidden;
            background: linear-gradient(145deg, #2d3748, #4a5568);
        }
        
        .display {
            min-height: 120px;
            word-break: break-all;
            overflow-wrap: break-word;
        }
        
        .btn {
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            filter: brightness(110%);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-number {
            background: linear-gradient(145deg, #4a5568, #2d3748);
        }
        
        .btn-operator {
            background: linear-gradient(145deg, #ed8936, #dd6b20);
        }
        
        .btn-equals {
            background: linear-gradient(145deg, #38a169, #2f855a);
        }
        
        .btn-clear {
            background: linear-gradient(145deg, #e53e3e, #c53030);
        }
        
        .btn-special {
            background: linear-gradient(145deg, #718096, #4a5568);
        }
        
        .theme-dark {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        
        .theme-light {
            background-color: #f7fafc;
            color: #2d3748;
        }
        
        .calculator-light {
            background: linear-gradient(145deg, #e2e8f0, #cbd5e0);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .btn-number-light {
            background: linear-gradient(145deg, #cbd5e0, #a0aec0);
            color: #2d3748;
        }
        
        .btn-operator-light {
            background: linear-gradient(145deg, #ed8936, #dd6b20);
            color: white;
        }
        
        .btn-equals-light {
            background: linear-gradient(145deg, #38a169, #2f855a);
            color: white;
        }
        
        .btn-clear-light {
            background: linear-gradient(145deg, #e53e3e, #c53030);
            color: white;
        }
        
        .btn-special-light {
            background: linear-gradient(145deg, #a0aec0, #718096);
            color: #2d3748;
        }
        
        /* Animation for display */
        @keyframes fadeIn {
            from { opacity: 0.7; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.2s ease-in-out;
        }
    </style>
</head>
<body class="theme-dark min-h-screen flex flex-col items-center justify-center p-4 transition-colors duration-300">
    <div class="w-full max-w-md mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl font-bold mb-2">Calculator App</h1>
            
            <div class="mt-6 flex justify-center items-center space-x-4">
                <div class="flex items-center">
                    <span class="mr-2">Theme:</span>
                    <button id="themeToggle" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors">
                        <i class="fas fa-moon mr-2"></i>Dark
                    </button>
                </div>
                
                <div class="flex items-center">
                    <span class="mr-2">History:</span>
                    <button id="historyToggle" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors">
                        <i class="fas fa-history mr-2"></i>Show
                    </button>
                </div>
            </div>
        </header>
        
        <div class="calculator p-6 rounded-2xl mb-8">
            <!-- Display Section -->
            <div class="display bg-gray-900 rounded-xl p-6 mb-6 text-right">
                <div id="historyDisplay" class="text-gray-400 text-lg mb-2 min-h-7"></div>
                <div id="display" class="text-5xl font-bold text-white fade-in">0</div>
            </div>
            
            <!-- Calculator Buttons Grid -->
            <div class="grid grid-cols-4 gap-4">
                <!-- Row 1 -->
                <button class="btn btn-clear col-span-2 p-5 rounded-xl text-2xl font-bold text-white flex items-center justify-center" onclick="clearAll()">
                    <i class="fas fa-backspace mr-2"></i>Clear
                </button>
                <button class="btn btn-special p-5 rounded-xl text-2xl font-bold text-white flex items-center justify-center" onclick="deleteLast()">
                    <i class="fas fa-delete-left"></i>
                </button>
                <button class="btn btn-operator p-5 rounded-xl text-2xl font-bold text-white" onclick="appendOperator('/')">÷</button>
                
                <!-- Row 2 -->
                <button class="btn btn-number p-5 rounded-xl text-2xl font-bold text-white" onclick="appendNumber('7')">7</button>
                <button class="btn btn-number p-5 rounded-xl text-2xl font-bold text-white" onclick="appendNumber('8')">8</button>
                <button class="btn btn-number p-5 rounded-xl text-2xl font-bold text-white" onclick="appendNumber('9')">9</button>
                <button class="btn btn-operator p-5 rounded-xl text-2xl font-bold text-white" onclick="appendOperator('*')">×</button>
                
                <!-- Row 3 -->
                <button class="btn btn-number p-5 rounded-xl text-2xl font-bold text-white" onclick="appendNumber('4')">4</button>
                <button class="btn btn-number p-5 rounded-xl text-2xl font-bold text-white" onclick="appendNumber('5')">5</button>
                <button class="btn btn-number p-5 rounded-xl text-2xl font-bold text-white" onclick="appendNumber('6')">6</button>
                <button class="btn btn-operator p-5 rounded-xl text-2xl font-bold text-white" onclick="appendOperator('-')">−</button>
                
                <!-- Row 4 -->
                <button class="btn btn-number p-5 rounded-xl text-2xl font-bold text-white" onclick="appendNumber('1')">1</button>
                <button class="btn btn-number p-5 rounded-xl text-2xl font-bold text-white" onclick="appendNumber('2')">2</button>
                <button class="btn btn-number p-5 rounded-xl text-2xl font-bold text-white" onclick="appendNumber('3')">3</button>
                <button class="btn btn-operator p-5 rounded-xl text-2xl font-bold text-white" onclick="appendOperator('+')">+</button>
                
                <!-- Row 5 -->
                <button class="btn btn-special p-5 rounded-xl text-2xl font-bold text-white" onclick="appendDecimal()">
                    <i class="fas fa-period"></i>
                </button>
                <button class="btn btn-number p-5 rounded-xl text-2xl font-bold text-white" onclick="appendNumber('0')">0</button>
                <button class="btn btn-special p-5 rounded-xl text-2xl font-bold text-white" onclick="toggleSign()">
                    <i class="fas fa-plus-minus"></i>
                </button>
                <button class="btn btn-equals p-5 rounded-xl text-2xl font-bold text-white text-3xl" onclick="calculate()">=</button>
            </div>
            
            <!-- Additional Function Buttons -->
            <div class="grid grid-cols-4 gap-4 mt-4">
                <button class="btn btn-special p-4 rounded-xl text-xl font-bold text-white" onclick="appendOperator('(')">(</button>
                <button class="btn btn-special p-4 rounded-xl text-xl font-bold text-white" onclick="appendOperator(')')">)</button>
                <button class="btn btn-special p-4 rounded-xl text-xl font-bold text-white" onclick="appendOperator('%')">%</button>
                <button class="btn btn-special p-4 rounded-xl text-xl font-bold text-white" onclick="calculateSquareRoot()">√</button>
            </div>
        </div>
        
        <!-- History Panel -->
        <div id="historyPanel" class="bg-gray-800 rounded-2xl p-6 mb-8 hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Calculation History</h2>
                <button id="clearHistory" class="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-500 text-white">
                    <i class="fas fa-trash mr-2"></i>Clear
                </button>
            </div>
            <div id="historyList" class="space-y-3 max-h-64 overflow-y-auto">
                <!-- History items will be added here -->
                <div class="text-gray-400 text-center py-4">No calculations yet</div>
            </div>
        </div>
        
        <footer class="text-center mt-8 text-gray-500">
        </footer>
    </div>

    <script>
        // Calculator state
        let currentDisplay = '0';
        let previousCalculation = '';
        let operator = null;
        let waitingForNewNumber = false;
        let calculationHistory = [];
        let isDarkTheme = true;
        
        // DOM elements
        const displayElement = document.getElementById('display');
        const historyDisplayElement = document.getElementById('historyDisplay');
        const historyPanel = document.getElementById('historyPanel');
        const historyList = document.getElementById('historyList');
        const themeToggle = document.getElementById('themeToggle');
        const historyToggle = document.getElementById('historyToggle');
        const clearHistoryButton = document.getElementById('clearHistory');
        
        // Initialize calculator
        function initCalculator() {
            updateDisplay();
            setupEventListeners();
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // History toggle
            historyToggle.addEventListener('click', toggleHistoryPanel);
            
            // Clear history
            clearHistoryButton.addEventListener('click', clearHistory);
            
            // Keyboard support
            document.addEventListener('keydown', handleKeyPress);
        }
        
        // Handle keyboard input
        function handleKeyPress(event) {
            const key = event.key;
            
            if (key >= '0' && key <= '9') {
                appendNumber(key);
            } else if (key === '.') {
                appendDecimal();
            } else if (key === '+') {
                appendOperator('+');
            } else if (key === '-') {
                appendOperator('-');
            } else if (key === '*') {
                appendOperator('*');
            } else if (key === '/') {
                event.preventDefault();
                appendOperator('/');
            } else if (key === 'Enter' || key === '=') {
                event.preventDefault();
                calculate();
            } else if (key === 'Escape') {
                clearAll();
            } else if (key === 'Backspace') {
                deleteLast();
            } else if (key === '%') {
                appendOperator('%');
            } else if (key === '(') {
                appendOperator('(');
            } else if (key === ')') {
                appendOperator(')');
            }
        }
        
        // Update display
        function updateDisplay() {
            displayElement.textContent = currentDisplay;
            displayElement.classList.add('fade-in');
            setTimeout(() => {
                displayElement.classList.remove('fade-in');
            }, 200);
            
            // Update history display
            historyDisplayElement.textContent = previousCalculation;
        }
        
        // Append number to display
        function appendNumber(number) {
            if (waitingForNewNumber) {
                currentDisplay = number;
                waitingForNewNumber = false;
            } else {
                currentDisplay = currentDisplay === '0' ? number : currentDisplay + number;
            }
            updateDisplay();
        }
        
        // Append operator
        function appendOperator(op) {
            if (op === '(' || op === ')') {
                // Handle parentheses
                if (waitingForNewNumber) {
                    currentDisplay = op;
                    waitingForNewNumber = false;
                } else {
                    currentDisplay = currentDisplay + op;
                }
                updateDisplay();
                return;
            }
            
            if (operator && !waitingForNewNumber) {
                // Calculate existing operation first
                calculate();
            }
            
            // Store the current display and operator
            previousCalculation = currentDisplay + ' ' + getOperatorSymbol(op);
            operator = op;
            waitingForNewNumber = true;
            updateDisplay();
        }
        
        // Get operator symbol for display
        function getOperatorSymbol(op) {
            switch(op) {
                case '+': return '+';
                case '-': return '−';
                case '*': return '×';
                case '/': return '÷';
                case '%': return '%';
                default: return op;
            }
        }
        
        // Append decimal point
        function appendDecimal() {
            if (waitingForNewNumber) {
                currentDisplay = '0.';
                waitingForNewNumber = false;
            } else if (!currentDisplay.includes('.')) {
                currentDisplay += '.';
            }
            updateDisplay();
        }
        
        // Toggle positive/negative
        function toggleSign() {
            if (currentDisplay !== '0') {
                if (currentDisplay.startsWith('-')) {
                    currentDisplay = currentDisplay.substring(1);
                } else {
                    currentDisplay = '-' + currentDisplay;
                }
                updateDisplay();
            }
        }
        
        // Delete last character
        function deleteLast() {
            if (currentDisplay.length > 1) {
                currentDisplay = currentDisplay.slice(0, -1);
            } else {
                currentDisplay = '0';
            }
            updateDisplay();
        }
        
        // Clear all
        function clearAll() {
            currentDisplay = '0';
            previousCalculation = '';
            operator = null;
            waitingForNewNumber = false;
            updateDisplay();
        }
        
        // Calculate result
        function calculate() {
            if (!operator || waitingForNewNumber) {
                return;
            }
            
            let result;
            const prev = parseFloat(previousCalculation.split(' ')[0]);
            const current = parseFloat(currentDisplay);
            
            try {
                switch(operator) {
                    case '+':
                        result = prev + current;
                        break;
                    case '-':
                        result = prev - current;
                        break;
                    case '*':
                        result = prev * current;
                        break;
                    case '/':
                        if (current === 0) {
                            throw new Error('Division by zero');
                        }
                        result = prev / current;
                        break;
                    case '%':
                        result = prev % current;
                        break;
                    default:
                        return;
                }
                
                // Round to avoid floating point issues
                result = Math.round(result * 100000000) / 100000000;
                
                // Add to history
                addToHistory(`${prev} ${getOperatorSymbol(operator)} ${current} = ${result}`);
                
                // Update display
                previousCalculation = previousCalculation + ' ' + current + ' =';
                currentDisplay = result.toString();
                operator = null;
                waitingForNewNumber = true;
                updateDisplay();
            } catch (error) {
                // Handle errors
                currentDisplay = 'Error';
                operator = null;
                waitingForNewNumber = true;
                updateDisplay();
                setTimeout(() => {
                    clearAll();
                }, 1500);
            }
        }
        
        // Calculate square root
        function calculateSquareRoot() {
            const value = parseFloat(currentDisplay);
            if (value >= 0) {
                const result = Math.sqrt(value);
                addToHistory(`√${value} = ${result}`);
                currentDisplay = result.toString();
                waitingForNewNumber = true;
                updateDisplay();
            } else {
                currentDisplay = 'Error';
                updateDisplay();
                setTimeout(() => {
                    clearAll();
                }, 1500);
            }
        }
        
        // Add calculation to history
        function addToHistory(calculation) {
            calculationHistory.unshift({
                calculation,
                timestamp: new Date().toLocaleTimeString()
            });
            
            // Keep only last 10 calculations
            if (calculationHistory.length > 10) {
                calculationHistory.pop();
            }
            
            updateHistoryDisplay();
        }
        
        // Update history display
        function updateHistoryDisplay() {
            historyList.innerHTML = '';
            
            if (calculationHistory.length === 0) {
                historyList.innerHTML = '<div class="text-gray-400 text-center py-4">No calculations yet</div>';
                return;
            }
            
            calculationHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'bg-gray-700 rounded-lg p-4 hover:bg-gray-600 transition-colors';
                historyItem.innerHTML = `
                    <div class="flex justify-between items-center">
                        <div class="font-mono text-lg">${item.calculation}</div>
                        <div class="text-gray-400 text-sm">${item.timestamp}</div>
                    </div>
                `;
                historyList.appendChild(historyItem);
            });
        }
        
        // Clear history
        function clearHistory() {
            calculationHistory = [];
            updateHistoryDisplay();
        }
        
        // Toggle history panel
        function toggleHistoryPanel() {
            const isHidden = historyPanel.classList.contains('hidden');
            historyPanel.classList.toggle('hidden');
            historyToggle.innerHTML = isHidden 
                ? '<i class="fas fa-history mr-2"></i>Hide' 
                : '<i class="fas fa-history mr-2"></i>Show';
        }
        
        // Toggle theme
        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            const body = document.body;
            const calculator = document.querySelector('.calculator');
            
            if (isDarkTheme) {
                body.classList.remove('theme-light');
                body.classList.add('theme-dark');
                calculator.classList.remove('calculator-light');
                themeToggle.innerHTML = '<i class="fas fa-moon mr-2"></i>Dark';
                
                // Update button classes
                updateButtonClasses('dark');
            } else {
                body.classList.remove('theme-dark');
                body.classList.add('theme-light');
                calculator.classList.add('calculator-light');
                themeToggle.innerHTML = '<i class="fas fa-sun mr-2"></i>Light';
                
                // Update button classes
                updateButtonClasses('light');
            }
        }
        
        // Update button classes based on theme
        function updateButtonClasses(theme) {
            const numberButtons = document.querySelectorAll('.btn-number');
            const operatorButtons = document.querySelectorAll('.btn-operator');
            const equalsButtons = document.querySelectorAll('.btn-equals');
            const clearButtons = document.querySelectorAll('.btn-clear');
            const specialButtons = document.querySelectorAll('.btn-special');
            
            if (theme === 'light') {
                numberButtons.forEach(btn => {
                    btn.classList.remove('btn-number');
                    btn.classList.add('btn-number-light');
                });
                operatorButtons.forEach(btn => {
                    btn.classList.remove('btn-operator');
                    btn.classList.add('btn-operator-light');
                });
                equalsButtons.forEach(btn => {
                    btn.classList.remove('btn-equals');
                    btn.classList.add('btn-equals-light');
                });
                clearButtons.forEach(btn => {
                    btn.classList.remove('btn-clear');
                    btn.classList.add('btn-clear-light');
                });
                specialButtons.forEach(btn => {
                    btn.classList.remove('btn-special');
                    btn.classList.add('btn-special-light');
                });
            } else {
                numberButtons.forEach(btn => {
                    btn.classList.remove('btn-number-light');
                    btn.classList.add('btn-number');
                });
                operatorButtons.forEach(btn => {
                    btn.classList.remove('btn-operator-light');
                    btn.classList.add('btn-operator');
                });
                equalsButtons.forEach(btn => {
                    btn.classList.remove('btn-equals-light');
                    btn.classList.add('btn-equals');
                });
                clearButtons.forEach(btn => {
                    btn.classList.remove('btn-clear-light');
                    btn.classList.add('btn-clear');
                });
                specialButtons.forEach(btn => {
                    btn.classList.remove('btn-special-light');
                    btn.classList.add('btn-special');
                });
            }
        }
        
        // Initialize calculator when page loads
        window.onload = initCalculator;
    </script>
</body>
</html>